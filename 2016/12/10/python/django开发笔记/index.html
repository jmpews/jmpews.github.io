<!DOCTYPE html><html lang="zh-CN"><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><meta name="author" content="jmpews,jmpews@gmail.com"><title>django开发笔记 · jmpews</title><meta name="description" content="入门配置篇12345678910111213141516171819202122232425262728293031323334353637383940414243# 模板&amp;apos;DIRS&amp;apos;: [BASE_DIR+&amp;quot;/templates&amp;quot;,]# 新建数据库pytho"><meta name="keywords" content="py,go,pwn,reverse"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="renderer" content="webkit"><link rel="short icon" href="/images/favicon.png" type="image/x-icon"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/blog_basic.css"><link rel="stylesheet" href="/css/font-awesome.min.css"><link rel="alternate" type="application/atom+xml" title="ATOM 1.0" href="/atom.xml"></head><body><div class="sidebar animated fadeInDown"><div class="logo-title"><div class="title"><img src="/images/logo@2x.png" style="width:127px;"><h3 title=""><a href="/">jmpews</a></h3><div class="description"><p>py &amp; go &amp; pwn &amp; reverse</p></div></div></div><ul class="social-links"><li><a href="https://twitter.com/jmpews"><i class="fa fa-twitter"></i></a></li><li><a href="http://weibo.com/winter1ife"><i class="fa fa-weibo"></i></a></li><li><a href="http://github.com/jmpews"><i class="fa fa-github"></i></a></li></ul><div class="footer"><a target="_blank" href="/"><span>Theme by </span></a><a href="https://www.caicai.me"> CaiCai </a><span>&</span><a href="https://github.com/Ben02/hexo-theme-Anatole"> Ben</a><div class="by_farbox"><a href="https://hexo.io/zh-cn/" target="_blank">Proudly published with Hexo&#65281;</a></div></div></div><div class="main"><div class="page-top animated fadeInDown"><div class="nav"><li><a href="/">首页</a></li><li><a href="/about">关于</a></li><li><a href="/archives">归档</a></li></div><div class="information"><div class="back_btn"><li><a onclick="window.history.go(-1)" class="fa fa-chevron-left"> </a></li></div><div class="avatar"><img src="/images/favicon.png"></div></div></div><div class="autopagerize_page_element"><div class="content"><div class="post-page"><div class="post animated fadeInDown"><div class="post-title"><h3><a>django开发笔记</a></h3></div><div class="post-content"><h2 id="入门配置篇"><a href="#入门配置篇" class="headerlink" title="入门配置篇"></a>入门配置篇</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div></pre></td><td class="code"><pre><div class="line"># 模板</div><div class="line">&apos;DIRS&apos;: [BASE_DIR+&quot;/templates&quot;,]</div><div class="line"></div><div class="line"># 新建数据库</div><div class="line">python manage.py migrate</div><div class="line">python manage.py makemigrations</div><div class="line"></div><div class="line"># 数据库相关操作</div><div class="line">list = Test.objects.all()</div><div class="line">Test.objects.filter(id=1)</div><div class="line">Publisher.objects.order_by(&quot;name&quot;)</div><div class="line">Publisher.objects.order_by(&quot;state_province&quot;, &quot;address&quot;)</div><div class="line">#相当于limit10</div><div class="line">Publisher.objects.order_by(&apos;name&apos;)[10]</div><div class="line"></div><div class="line"># 批量update</div><div class="line">Publisher.objects.filter(id=52).update(name=&apos;Apress Publishing&apos;)</div><div class="line"></div><div class="line"># 批量删除   </div><div class="line">Publisher.objects.filter(country=&apos;USA&apos;).delete()</div><div class="line"></div><div class="line"># 提取数据</div><div class="line">try:</div><div class="line">    p = Publisher.objects.get(name=&apos;Apress&apos;)</div><div class="line">except Publisher.DoesNotExist:</div><div class="line"></div><div class="line"># django admin管理,字符型可以仅仅使用blank，而一些以其他数据，需要加上null</div><div class="line">publication_date = models.DateField(**blank=True, null=True** )</div><div class="line"></div><div class="line"># model降序</div><div class="line">class Article(models.Model):</div><div class="line">    class Meta:  #按时间下降排序</div><div class="line">        ordering = [&apos;-date_time&apos;]</div><div class="line"></div><div class="line"></div><div class="line"># 变量描述</div><div class="line">forloop.counter 索引从 1 开始算</div><div class="line">forloop.counter0 索引从 0 开始算</div><div class="line">forloop.revcounter 索引从最大长度到 1</div><div class="line">forloop.revcounter0 索引从最大长度到 0</div><div class="line">forloop.first 当遍历的元素为第一项时为真</div><div class="line">forloop.last 当遍历的元素为最后一项时为真</div><div class="line">forloop.parentloop 用在嵌套的 for 循环中，</div></pre></td></tr></table></figure>
<h2 id="Admin基本配置"><a href="#Admin基本配置" class="headerlink" title="Admin基本配置"></a>Admin基本配置</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"># 每一个条目显示的字段</div><div class="line">list_display = (&apos;first_name&apos;, &apos;last_name&apos;, &apos;email&apos;)</div><div class="line"># 每一个条目支持修改的字段</div><div class="line">fields = (&apos;title&apos;, &apos;authors&apos;, &apos;publisher&apos;)</div></pre></td></tr></table></figure>
<h2 id="Django下URLconf配置"><a href="#Django下URLconf配置" class="headerlink" title="Django下URLconf配置"></a>Django下URLconf配置</h2><h4 id="1-使用命名组参数"><a href="#1-使用命名组参数" class="headerlink" title="1.使用命名组参数"></a>1.使用命名组参数</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">urlpatterns = patterns(&apos;&apos;,</div><div class="line">    # 命名组参数year,month</div><div class="line">    (r&apos;^articles/(?P&lt;year&gt;\d&#123;4&#125;)/$&apos;, views.year_archive),</div><div class="line">    (r&apos;^articles/(?P&lt;year&gt;\d&#123;4&#125;)/(?P&lt;month&gt;\d&#123;2&#125;)/$&apos;, views.month_archive),</div><div class="line">)</div></pre></td></tr></table></figure>
<h4 id="2-传递额外参数"><a href="#2-传递额外参数" class="headerlink" title="2.传递额外参数"></a>2.传递额外参数</h4><p>增加了URL和Views的耦合度</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"># 不好！！！！ 增加了URL和Views的耦合度</div><div class="line">urlpatterns = patterns(&apos;&apos;,</div><div class="line">    (r&apos;^(foo)/$&apos;, views.foobar_view),</div><div class="line">    (r&apos;^(bar)/$&apos;, views.foobar_view),</div><div class="line">)</div><div class="line"></div><div class="line">def foobar_view(request, url):</div><div class="line">    m_list = MyModel.objects.filter(is_new=True)</div><div class="line">    if url == &apos;foo&apos;:</div><div class="line">        template_name = &apos;template1.html&apos;</div><div class="line">    elif url == &apos;bar&apos;:</div><div class="line">        template_name = &apos;template2.html&apos;</div><div class="line">    return render_to_response(template_name, &#123;&apos;m_list&apos;: m_list&#125;)</div></pre></td></tr></table></figure>
<p>传递额外参数</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">urlpatterns = patterns(&apos;&apos;,</div><div class="line">    # 传递了额外参数,template_name</div><div class="line">    (r&apos;^foo/$&apos;, views.foobar_view, &#123;&apos;template_name&apos;: &apos;template1.html&apos;&#125;),</div><div class="line">    (r&apos;^bar/$&apos;, views.foobar_view, &#123;&apos;template_name&apos;: &apos;template2.html&apos;&#125;),</div><div class="line">)</div><div class="line"></div><div class="line">def foobar_view(request, template_name):</div><div class="line">    m_list = MyModel.objects.filter(is_new=True)</div><div class="line">    return render_to_response(template_name, &#123;&apos;m_list&apos;: m_list&#125;)</div></pre></td></tr></table></figure>
<p>伪造URLconf参数</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">urlpatterns = patterns(&apos;&apos;,</div><div class="line">    # 对于特例情况下，伪造urlconf</div><div class="line">    (r&apos;^mydata/birthday/$&apos;, views.my_view, &#123;&apos;month&apos;: &apos;jan&apos;, &apos;day&apos;: &apos;06&apos;&#125;),</div><div class="line">    (r&apos;^mydata/(?P&lt;month&gt;\w&#123;3&#125;)/(?P&lt;day&gt;\d\d)/$&apos;, views.my_view),</div><div class="line">)</div></pre></td></tr></table></figure>
<ul>
<li>额外参数优先级要高对于捕获参数的优先级</li>
<li>url匹配存在短路逻辑</li>
<li>从url提取的所有参数均为文本</li>
</ul>
<h4 id="post和get分给不同函数处理"><a href="#post和get分给不同函数处理" class="headerlink" title="post和get分给不同函数处理"></a>post和get分给不同函数处理</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"># 这里的参数，*args列表类型,**kwargs字典类型</div><div class="line">def method_splitter(request, *args, **kwargs):</div><div class="line">    get_view = kwargs.pop(&apos;GET&apos;, None)</div><div class="line">    post_view = kwargs.pop(&apos;POST&apos;, None)</div><div class="line">    if request.method == &apos;GET&apos; and get_view is not None:</div><div class="line">        return get_view(request, *args, **kwargs)</div><div class="line">    elif request.method == &apos;POST&apos; and post_view is not None:</div><div class="line">        return post_view(request, *args, **kwargs)</div><div class="line">    raise Http404</div></pre></td></tr></table></figure>
<h2 id="装饰器-访问很多页面要求已经登陆"><a href="#装饰器-访问很多页面要求已经登陆" class="headerlink" title="装饰器(访问很多页面要求已经登陆)"></a>装饰器(访问很多页面要求已经登陆)</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"># 可以做成装饰器</div><div class="line">def requires_login(view):</div><div class="line">    def new_view(request, *args, **kwargs):</div><div class="line">        if not request.user.is_authenticated():</div><div class="line">            return HttpResponseRedirect(&apos;/accounts/login/&apos;)</div><div class="line">        return view(request, *args, **kwargs)</div><div class="line">    return new_view</div></pre></td></tr></table></figure>
<h2 id="渲染模板"><a href="#渲染模板" class="headerlink" title="渲染模板"></a>渲染模板</h2><p>RequestContext可以包含req参数，同时可以将这个请求过程中一直存在的参数放到其中，相比Context而言。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">def custom_proc(request):</div><div class="line">    &quot;A context processor that provides &apos;app&apos;, &apos;user&apos; and &apos;ip_address&apos;.&quot;</div><div class="line">    return &#123;</div><div class="line">        &apos;app&apos;: &apos;My app&apos;,</div><div class="line">        &apos;user&apos;: request.user,</div><div class="line">        &apos;ip_address&apos;: request.META[&apos;REMOTE_ADDR&apos;]</div><div class="line">    &#125;</div><div class="line"></div><div class="line">def view_1(request):</div><div class="line">    return render_to_response(&apos;template1.html&apos;,</div><div class="line">        &#123;&apos;message&apos;: &apos;I am view 1.&apos;&#125;,</div><div class="line">        # 多个视图通用的参数</div><div class="line">        context_instance=RequestContext(request, processors=[custom_proc]))</div></pre></td></tr></table></figure>
<h4 id="关闭模板自转义"><a href="#关闭模板自转义" class="headerlink" title="关闭模板自转义"></a>关闭模板自转义</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">&#123;% autoescape off %&#125;</div><div class="line">    Hello &#123;&#123; name &#125;&#125;</div><div class="line">&#123;% endautoescape %&#125;</div></pre></td></tr></table></figure>
<h4 id="url规则名字，自动更改前缀"><a href="#url规则名字，自动更改前缀" class="headerlink" title="url规则名字，自动更改前缀"></a>url规则名字，自动更改前缀</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">url(r&apos;^add/(\d+)/(\d+)/$&apos;, &apos;app.views.add&apos;, name=&apos;add&apos;),</div><div class="line">&#123;% url &apos;some-url-name&apos; arg arg2 as the_url %&#125;</div></pre></td></tr></table></figure>
<h2 id="Model高级"><a href="#Model高级" class="headerlink" title="Model高级"></a>Model高级</h2><h4 id="增加数据库manager方法"><a href="#增加数据库manager方法" class="headerlink" title="增加数据库manager方法"></a>增加数据库manager方法</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">class BookManager(models.Manager):</div><div class="line">    def title_count(self, keyword):</div><div class="line">        return self.filter(title__icontains=keyword).count()</div><div class="line">    #修改初始Manager QuerySets</div><div class="line">    def get_query_set(self):</div><div class="line">        return super(DahlBookManager, self).get_query_set().filter(author=&apos;Roald Dahl&apos;)</div><div class="line"></div><div class="line">class Book(models.Model):</div><div class="line">    ...</div><div class="line">    objects = BookManager()</div><div class="line">    roald_objects=BookManager()</div></pre></td></tr></table></figure>
<h4 id="用户model自定义"><a href="#用户model自定义" class="headerlink" title="用户model自定义"></a>用户model自定义</h4><p><a href="https://docs.djangoproject.com/en/dev/topics/auth/customizing/#substituting-a-custom-user-model" target="_blank" rel="external">https://docs.djangoproject.com/en/dev/topics/auth/customizing/#substituting-a-custom-user-model</a></p>
<p><code>AbstractBaseUser</code> 是全部定制，需要重写覆盖<code>BaseUserManager</code>,<code>BaseUserAdmin</code></p>
<p><code>AbstractUser</code> 如果只是扩展字段可以用这个</p>
</div><div class="post-footer"><div class="meta"><div class="info"><i class="fa fa-sun-o"></i><span class="date">2016-12-10</span><i class="fa fa-tag"></i><a href="/categories/python/" title="python" class="tag">python </a><a href="/tags/python/" title="python" class="tag">python </a><a href="/tags/django/" title="django" class="tag">django </a></div></div></div></div><div class="share"><div class="evernote"><a href="javascript:(function(){EN_CLIP_HOST='http://www.evernote.com';try{var%20x=document.createElement('SCRIPT');x.type='text/javascript';x.src=EN_CLIP_HOST+'/public/bookmarkClipper.js?'+(new%20Date().getTime()/100000);document.getElementsByTagName('head')[0].appendChild(x);}catch(e){location.href=EN_CLIP_HOST+'/clip.action?url='+encodeURIComponent(location.href)+'&amp;title='+encodeURIComponent(document.title);}})();" ref="nofollow" target="_blank" class="fa fa-bookmark"></a></div><div class="weibo"><a href="javascript:void((function(s,d,e){try{}catch(e){}var f='http://service.weibo.com/share/share.php?',u=d.location.href,p=['url=',e(u),'&amp;title=',e(d.title),'&amp;appkey=2924220432'].join('');function a(){if(!window.open([f,p].join(''),'mb',['toolbar=0,status=0,resizable=1,width=620,height=450,left=',(s.width-620)/2,',top=',(s.height-450)/2].join('')))u.href=[f,p].join('');};if(/Firefox/.test(navigator.userAgent)){setTimeout(a,0)}else{a()}})(screen,document,encodeURIComponent));" class="fa fa-weibo"></a></div><div class="twitter"><a href="http://twitter.com/home?status=,http://jmpews.github.com/2016/12/10/python/django开发笔记/,jmpews,django开发笔记,;" class="fa fa-twitter"></a></div></div><div class="pagination"><ul class="clearfix"><li class="pre pagbuttons"><a role="navigation" href="/2016/12/10/python/flask开发笔记/" title="flask开发笔记" class="btn">上一篇</a></li><li class="next pagbuttons"><a role="navigation" href="/2016/12/10/python/docker备忘笔记/" title="docker备忘笔记" class="btn">下一篇</a></li></ul></div></div></div></div></div><script src="/js/jquery.js"></script><script src="/js/jquery-migrate-1.2.1.min.js"></script><script src="/js/jquery.appear.js"></script></body></html>