<!DOCTYPE html><html lang="zh-CN"><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><meta name="author" content="jmpews,jmpews@gmail.com"><title>sicp换零钱-递归转尾递归 · jmpews</title><meta name="description" content="前言递归和迭代的转化，关键需要明确哪些是递归的冗余数据，也就说哪些是迭代可以重复利用数据。下面具体分析。
给不同的coin分配索引
123456(define (first-denomination kinds-of-coins)    (cond ((= kinds-of-coins 1) 1) "><meta name="keywords" content="py,go,pwn,reverse"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="renderer" content="webkit"><link rel="short icon" href="/images/favicon.png" type="image/x-icon"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/blog_basic.css"><link rel="stylesheet" href="/css/font-awesome.min.css"><link rel="alternate" type="application/atom+xml" title="ATOM 1.0" href="/atom.xml"></head><body><div class="sidebar animated fadeInDown"><div class="logo-title"><div class="title"><img src="/images/logo@2x.png" style="width:127px;"><h3 title=""><a href="/">jmpews</a></h3><div class="description"><p>py &amp; go &amp; pwn &amp; reverse</p></div></div></div><ul class="social-links"><li><a href="https://twitter.com/jmpews"><i class="fa fa-twitter"></i></a></li><li><a href="http://weibo.com/winter1ife"><i class="fa fa-weibo"></i></a></li><li><a href="http://github.com/jmpews"><i class="fa fa-github"></i></a></li></ul><div class="footer"><a target="_blank" href="/"><span>Theme by </span></a><a href="https://www.caicai.me"> CaiCai </a><span>&</span><a href="https://github.com/Ben02/hexo-theme-Anatole"> Ben</a><div class="by_farbox"><a href="https://hexo.io/zh-cn/" target="_blank">Proudly published with Hexo&#65281;</a></div></div></div><div class="main"><div class="page-top animated fadeInDown"><div class="nav"><li><a href="/">首页</a></li><li><a href="/about">关于</a></li><li><a href="/archives">归档</a></li></div><div class="information"><div class="back_btn"><li><a onclick="window.history.go(-1)" class="fa fa-chevron-left"> </a></li></div><div class="avatar"><img src="/images/favicon.png"></div></div></div><div class="autopagerize_page_element"><div class="content"><div class="post-page"><div class="post animated fadeInDown"><div class="post-title"><h3><a>sicp换零钱-递归转尾递归</a></h3></div><div class="post-content"><h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>递归和迭代的转化，关键需要明确哪些是递归的冗余数据，也就说哪些是迭代可以重复利用数据。下面具体分析。</p>
<p>给不同的coin分配索引</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">(define (first-denomination kinds-of-coins)</div><div class="line">    (cond ((= kinds-of-coins 1) 1)</div><div class="line">        ((= kinds-of-coins 2) 5)</div><div class="line">        ((= kinds-of-coins 3) 10)</div><div class="line">        ((= kinds-of-coins 4) 25)</div><div class="line">        ((= kinds-of-coins 5) 50)))</div></pre></td></tr></table></figure>
<h2 id="递归的思路"><a href="#递归的思路" class="headerlink" title="递归的思路"></a>递归的思路</h2><p>将总数为a的现金换成n种硬币的不同方式的数目等于</p>
<ol>
<li>将现金a换成除第一种硬币以外的其他硬币的不同方式，加上2</li>
<li>将现金a－d换成所有种类硬币的不同方式。其中d为第一种硬币的面值。</li>
</ol>
<p>可以写递归公式</p>
<p><code>Ct(N) = Ct(N-first-denomination(t)) + Ct-1(N)</code></p>
<p>t(下标)为几种硬币，N为现金数。例如：t为5，N为100美分，所以总数目=(将100美分换成1,5,10,25这四种硬币组成方法数)+(将100-50美分换成1,5,10,25,50这五种硬币组成的方法数)</p>
<p>通过公式进行初步运算，渐渐会发现冗余数据(重复利用的数据)</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div></pre></td><td class="code"><pre><div class="line">C5(100)=C4(100)+C5(50)</div><div class="line">    C4(100)==C3(100)+C4(75)</div><div class="line">        C3(100)=C2(100)+C3(90)</div><div class="line">            C2(100)=C1(100)+C2(95)</div><div class="line">                C2(95)=C1(95)+C2(90)</div><div class="line">                    C2(90)=C1(90)+C2(85)</div><div class="line">                        C2(85)=C1(85)+C2(80)</div><div class="line">                            C2(80)=C1(80)+C2(75)</div><div class="line">                                C2(75)=C1(75)+C2(70)</div><div class="line">                                    ...</div><div class="line">            # C2(90) 重复</div><div class="line">            C3(90)=C2(90)+C3(80)</div><div class="line">                # C2(80) 重复</div><div class="line">                C3(80)=C2(80)+C3(70)</div><div class="line">                    # C2(70) 重复</div><div class="line">                    C3(70)=C2(70)+C3(60)</div><div class="line">                        ...</div><div class="line">        C4(75)=C3(75)+C4(50)</div><div class="line">            C3(75)=C2(75)+C3(65)</div><div class="line">                ...</div><div class="line">            C4(50)=C3(50)+C4(25)</div><div class="line">                ...</div><div class="line">    C5(50)=C4(50)+C5(0)</div><div class="line">        C5(50)=C4(50)+C5(0)</div><div class="line">            ...</div></pre></td></tr></table></figure>
<p>上面可能不太直观</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div></pre></td><td class="code"><pre><div class="line">C2(4) = C1(4) + C2(-1)</div><div class="line">C2(5) = C1(5) + C2(0)</div><div class="line">C2(6) = C1(6) + C2(1)</div><div class="line">C2(7) = C1(7) + C2(2)</div><div class="line">C2(8) = C1(8) + C2(3)</div><div class="line">C2(9) = C1(9) + C2(4) //出现重复利用值C2(4) 间隔为5</div><div class="line">C2(10) = C1(10) + C2(5) //出现重复利用值C2(5) 间隔为5</div><div class="line">C2(11) = C1(11) + C2(6)</div><div class="line">C2(12) = C1(12) + C2(7)</div><div class="line">C2(13) = C1(13) + C2(8)</div><div class="line">C2(14) = C1(14) + C2(9)</div><div class="line">C2(15) = C1(15) + C2(10)</div><div class="line">C2(16) = C1(16) + C2(11)</div><div class="line"></div><div class="line"></div><div class="line">C3(4) = C2(4) + C3(-6)</div><div class="line">C3(5) = C2(5) + C3(-5)</div><div class="line">C3(6) = C2(6) + C3(-4)</div><div class="line">C3(7) = C2(7) + C3(-3)</div><div class="line">C3(8) = C2(8) + C3(-2)</div><div class="line">C3(9) = C2(9) + C3(-1)</div><div class="line">C3(10) = C2(10) + C3(0)</div><div class="line">C3(11) = C2(11) + C3(1)</div><div class="line">C3(12) = C2(12) + C3(2)</div><div class="line">C3(13) = C2(13) + C3(3)</div><div class="line">C3(14) = C2(14) + C3(4) //出现重复利用值C3(4) 间隔为10</div><div class="line">C3(15) = C2(15) + C3(5) //出现重复利用值C3(5) 间隔为10</div><div class="line">C3(16) = C2(16) + C3(6)</div></pre></td></tr></table></figure>
<p><strong>所以对于C2来说，始终需要缓存5个可以重复利用值(长度为5的缓存队列);对于C3，始终需要缓存10个可以重复利用值(长度为10的缓存队列);对于C4，使用需要缓存25个(…);对于C5来说，使用需要缓存50个可以重复利用值(…)</strong></p>
<h2 id="迭代思路"><a href="#迭代思路" class="headerlink" title="迭代思路"></a>迭代思路</h2><ol>
<li>迭代是线性O(n)时间+常量空间消耗(不会随n改变)</li>
<li>迭代需要<strong>重复利用</strong>递归产生的冗余数据.</li>
<li>迭代的状态能由这些变量完全刻画</li>
</ol>
<p>假设有5种硬币，现金100美分</p>
<p>C 源码</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div><div class="line">130</div><div class="line">131</div><div class="line">132</div><div class="line">133</div><div class="line">134</div><div class="line">135</div><div class="line">136</div><div class="line">137</div><div class="line">138</div><div class="line">139</div><div class="line">140</div><div class="line">141</div><div class="line">142</div><div class="line">143</div><div class="line">144</div><div class="line">145</div></pre></td><td class="code"><pre><div class="line">/*</div><div class="line"> * =====================================================================================</div><div class="line"> *</div><div class="line"> *  Filename:  p26.c</div><div class="line"> *</div><div class="line"> *  Description: change money</div><div class="line"> *</div><div class="line"> *  Version:  1.0</div><div class="line"> *  Created:  2016/08/02 14时58分22秒</div><div class="line"> *  Revision:  none</div><div class="line"> *  Compiler:  gcc</div><div class="line"> *</div><div class="line"> *  Author:  jmpews (jmpews.github.io), jmpews@gmail.com</div><div class="line"> *</div><div class="line"> * =====================================================================================</div><div class="line"> */</div><div class="line"></div><div class="line"></div><div class="line">#include &lt;stdlib.h&gt;</div><div class="line">#include &lt;stdio.h&gt;</div><div class="line">#include &lt;string.h&gt;</div><div class="line">int count_change(int amount);</div><div class="line">int cc(int amount, int kinds_of_coins);</div><div class="line">void count_iter(int *tmp, int t, int amount);</div><div class="line">int get_coin(int index_of_coin);</div><div class="line">int get_index_tmp(int index_of_coin);</div><div class="line">int *get_tmp_array(int kinds_of_coins);</div><div class="line">int get_recycle_value(int index_of_coin, int current_amount, int *tmp_array);</div><div class="line">void update_recycle_value(int index_of_coin, int *tmp_array, int value);</div><div class="line"></div><div class="line">int main ( int argc, char *argv[] )</div><div class="line">&#123;</div><div class="line">    int t;</div><div class="line">    t = count_change(100);</div><div class="line">    printf(&quot;%d&quot;, t);</div><div class="line">    return EXIT_SUCCESS;</div><div class="line">&#125;				/* ----------  end of function main  ---------- */</div><div class="line"></div><div class="line">int count_change(int amount) &#123;</div><div class="line">    cc(amount, 5);</div><div class="line">    return 0;</div><div class="line">&#125;</div><div class="line"></div><div class="line">int cc(int amount, int kinds_of_coins) &#123;</div><div class="line">    int *tmp = get_tmp_array(kinds_of_coins);</div><div class="line">    int t = 0;</div><div class="line">    tmp[0] = 0;</div><div class="line">    count_iter(tmp, t, amount);</div><div class="line">    return 0;</div><div class="line">&#125;</div><div class="line"></div><div class="line">// 这里这里也是关键点，这个尾递归的结束由t(当前需要兑换的金钱)和amount(需要兑换的目标金钱)控制，为线性，也就是说时间复杂度为O(n)</div><div class="line">void count_iter(int *tmp, int t, int amount) &#123;</div><div class="line">    int r;</div><div class="line">    r = get_recycle_value(1, t, tmp);</div><div class="line">    update_recycle_value(1, tmp, r);</div><div class="line"></div><div class="line">    //C2(t) = C2(t-get_coin(2)) + C1(t)</div><div class="line">    r = get_recycle_value(2, t, tmp) + r;</div><div class="line">    update_recycle_value(2, tmp, r);</div><div class="line"></div><div class="line">    //C3(t) = C3(t-get_coin(3)) + C2(t)</div><div class="line">    r = get_recycle_value(3, t, tmp) + r;</div><div class="line">    update_recycle_value(3, tmp, r);</div><div class="line"></div><div class="line">    //C4(t) = C4(t-get_coin(4)) + C3(t)</div><div class="line">    r= get_recycle_value(4, t, tmp) + r;</div><div class="line">    update_recycle_value(4, tmp, r);</div><div class="line"></div><div class="line">    //C5(t) = C5(t-get_coin(5)) + C4(t)</div><div class="line">    r = get_recycle_value(5, t, tmp) + r;</div><div class="line">    if(t == amount) &#123;</div><div class="line">        printf(&quot;final-value: %d\n&quot;, r);</div><div class="line">        exit(1);</div><div class="line">    &#125;</div><div class="line">    update_recycle_value(5, tmp, r);</div><div class="line"></div><div class="line">    count_iter(tmp, t+1, amount);</div><div class="line">&#125;</div><div class="line"></div><div class="line">int get_coin(int index_of_coin) &#123;</div><div class="line">    switch(index_of_coin) &#123;</div><div class="line">        case 1: return 1;</div><div class="line">        case 2: return 5;</div><div class="line">        case 3: return 10;</div><div class="line">        case 4: return 25;</div><div class="line">        case 5: return 50;</div><div class="line">        default: exit(1);</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line">// 对于C1、C2、C3、C4、C5缓存队列开始的位置</div><div class="line">int get_index_tmp(int index_of_coin) &#123;</div><div class="line">    switch(index_of_coin) &#123;</div><div class="line">        case 1: return 0;</div><div class="line">        case 2: return 1;</div><div class="line">        case 3: return 6;</div><div class="line">        case 4: return 16;</div><div class="line">        case 5: return 41;</div><div class="line">        default: exit(1);</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line">// 分配固定的缓存, 无论需要兑换多少金钱，只要金币种类不变，缓存的大小就是固定的。 空间复杂度为常量。</div><div class="line">// &quot;因为它的状态能由其中的三个状态变量完全刻画，解释器在执行 这一计算过程时，只需要保存这三个变量的轨迹就足够了&quot; 这句话在这里就有体现了</div><div class="line">int *get_tmp_array(int kinds_of_coins) &#123;</div><div class="line">    int *tmp;</div><div class="line">    int i;</div><div class="line">    int sum = 0;</div><div class="line">    for(i=1 ; i&lt;kinds_of_coins ; i++) &#123;</div><div class="line">        sum += get_coin(i);</div><div class="line">    &#125;</div><div class="line">    tmp = (int *)malloc(sizeof(int) * sum);</div><div class="line">    memset(tmp, 0 ,sizeof(int) * sum);</div><div class="line">    return tmp;</div><div class="line">&#125;</div><div class="line"></div><div class="line">// 获取重复利用值, 每次缓存队列头的位置</div><div class="line">// 比如: 此时缓存队列为[C2(0), C2(1), C2(2), C2(3), C2(4)]</div><div class="line">// C2(5) = C1(5) + C2(0) 此时我们需要取缓存队列头的值C2(0)</div><div class="line">// 计算完得到C2(5)，需要执行update_recycle_value将得到C2(5)进队列，除去旧的C2(0)，此时队列头尾C2(1)，即为计算C2(6)需要的缓存值</div><div class="line">int get_recycle_value(int index_of_coin, int current_amount, int *tmp_array) &#123;</div><div class="line">    int t = get_index_tmp(index_of_coin);</div><div class="line">    if(current_amount &lt; get_coin(index_of_coin))&#123;</div><div class="line">        return 0;</div><div class="line">    &#125;</div><div class="line">    else if(current_amount == get_coin(index_of_coin))&#123;</div><div class="line">        return 1;</div><div class="line">    &#125;</div><div class="line">    else &#123;</div><div class="line">        return tmp_array[t];</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line">// 更新重复利用值(队列的概念), 计算出最新的值，需要替换旧的利用值</div><div class="line">// 比如: C2(5) = C1(5) + C2(0)</div><div class="line">// 现在C2缓存队列中有[C2(0), C2(1), C2(2), C2(3), C2(4)]，我们需要将C2(5)进队列，[C2(1), C2(2), C2(3), C2(4), C2(5)]</div><div class="line">void update_recycle_value(int index_of_coin, int *tmp_array, int value) &#123;</div><div class="line">    int i;</div><div class="line">    int t = get_index_tmp(index_of_coin);</div><div class="line">    for(i = 0; i&lt; (get_coin(index_of_coin)-1); i++) &#123;</div><div class="line">        tmp_array[t+i] = tmp_array[t+i+1];</div><div class="line">    &#125;</div><div class="line">    tmp_array[t+get_coin(index_of_coin)-1] = value;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h3><p><a href="http://stackoverflow.com/questions/1485022/sicp-making-change/" target="_blank" rel="external">http://stackoverflow.com/questions/1485022/sicp-making-change/</a></p>
</div><div class="post-footer"><div class="meta"><div class="info"><i class="fa fa-sun-o"></i><span class="date">2016-12-10</span><i class="fa fa-tag"></i><a href="/categories/notes/" title="notes" class="tag">notes </a><a href="/tags/sicp/" title="sicp" class="tag">sicp </a></div></div></div></div><div class="share"><div class="evernote"><a href="javascript:(function(){EN_CLIP_HOST='http://www.evernote.com';try{var%20x=document.createElement('SCRIPT');x.type='text/javascript';x.src=EN_CLIP_HOST+'/public/bookmarkClipper.js?'+(new%20Date().getTime()/100000);document.getElementsByTagName('head')[0].appendChild(x);}catch(e){location.href=EN_CLIP_HOST+'/clip.action?url='+encodeURIComponent(location.href)+'&amp;title='+encodeURIComponent(document.title);}})();" ref="nofollow" target="_blank" class="fa fa-bookmark"></a></div><div class="weibo"><a href="javascript:void((function(s,d,e){try{}catch(e){}var f='http://service.weibo.com/share/share.php?',u=d.location.href,p=['url=',e(u),'&amp;title=',e(d.title),'&amp;appkey=2924220432'].join('');function a(){if(!window.open([f,p].join(''),'mb',['toolbar=0,status=0,resizable=1,width=620,height=450,left=',(s.width-620)/2,',top=',(s.height-450)/2].join('')))u.href=[f,p].join('');};if(/Firefox/.test(navigator.userAgent)){setTimeout(a,0)}else{a()}})(screen,document,encodeURIComponent));" class="fa fa-weibo"></a></div><div class="twitter"><a href="http://twitter.com/home?status=,http://jmpews.github.com/2016/12/10/notes/sicp换零钱/,jmpews,sicp换零钱-递归转尾递归,;" class="fa fa-twitter"></a></div></div><div class="pagination"><ul class="clearfix"><li class="pre pagbuttons"><a role="navigation" href="/2016/12/10/python/异步在Tornado中的实现/" title="异步在tornado中的实现" class="btn">上一篇</a></li><li class="next pagbuttons"><a role="navigation" href="/2016/12/10/notes/tcp.ip阅读笔记/" title="TCP/IP备忘笔记" class="btn">下一篇</a></li></ul></div></div></div></div></div><script src="/js/jquery.js"></script><script src="/js/jquery-migrate-1.2.1.min.js"></script><script src="/js/jquery.appear.js"></script></body></html>